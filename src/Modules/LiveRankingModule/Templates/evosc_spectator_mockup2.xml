<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<manialink version="3">
<!-- components -->
<framemodel id="player">
<quad pos="0 0" z-index="1" size="7 5" style="UICommon64_1" substyle="BgFrame2" opacity="1" colorize="dc0"/>
<label pos="3.5 -2.25" z-index="2" size="7 5" text="1" halign="center" valign="center" textfont="GameFontExtraBold" textsize="2" textcolor="000000FF" textprefix="$i"/>

<label pos="10 -2.5" z-index="3" size="50 5" text="{{Extra long user name}}" valign="center2" textfont="GameFontSemiBold" textsize="1" textprefix="$i$t"/>
<label pos="65 -2.5" z-index="3" size="15 5" text="01:30.238" valign="center2" textfont="GameFontSemiBold" textsize="1" textprefix="$i$t" halign="center"/>

<quad z-index="2" pos="9 0" size="50 5" image="file://Media/Painter/Stencils/15-Stripes/_Stripe0Grad/Brush.tga" opacity="1" modulatecolor="484a5a" />
</framemodel>
<label pos="0 -5.95" z-index="0" size="39.7 11.9" text="Update Ranking" valign="center2" halign="center" scriptevents="1" focusareacolor1="005" focusareacolor2="339" id="Update"/>

<!-- LIVE RANKINGS-->
<frame id="live_rankings" pos="-160 82">
<frame size="85 6">
<label pos="8 -3" z-index="5" size="20 5" text="Live Ranking" valign="center2" textfont="GameFontExtraBold" textprefix="$i$t" textsize="2"/>
<quad z-index="1" pos="32 -3" size="6.2 85" valign="center"  halign="center" style="UICommon64_1" substyle="BgFrame1" colorize="4357ea"  rot="90"/>
<quad z-index="2" size="63 6" image="file://Media/Painter/Stencils/15-Stripes/_Stripe0Grad/Brush.tga" opacity="1" modulatecolor="161a35"pos="31 0" halign="center"/>
</frame>

<frame id="players" pos="0 -7" size="80 27">
	<frameinstance modelid="player" pos="1.5  0"/>
	<frameinstance modelid="player" pos="1.5 -7 "/>
	<frameinstance modelid="player" pos="1.5 -14 "/>
	<frameinstance modelid="player" pos="1.5 -21 "/>				
	<frameinstance modelid="player" pos="1.5 -28 "/>				
	<frameinstance modelid="player" pos="1.5 -32 "/>					
</frame>
<quad pos="-0.2 -5.5" z-index="0" size="74.6 29" bgcolor="24262f" opacity="0.9"/>
</frame>

<!-- MATCH RANKINGS -->
<frame id="match_ranking" pos="85 82">
<frame size="75.3 6" pos="-1 0">
<label pos="10 -3" z-index="5" size="20 5" text="Match Ranking" valign="center2" textfont="GameFontExtraBold" textprefix="$i$t" textsize="2"/>
<quad z-index="1" pos="37.7 -3" size="74.5 6" valign="center"  halign="center" style="UICommon64_1" substyle="BgFrame1" colorize="4357ea"/>
<quad z-index="2" size="76.2 6" image="file://Media/Painter/Stencils/15-Stripes/_Stripe0Grad/Brush.tga" opacity="1" modulatecolor="161a35"pos="38.6 -3" halign="center" valign="center" rot="180"/>
</frame>

<frame id="players" pos="0 -8">
	<frameinstance modelid="player" pos="1.5  0"/>
	<frameinstance modelid="player" pos="1.5 -7 "/>
	<frameinstance modelid="player" pos="1.5 -14 "/>
	<frameinstance modelid="player" pos="1.5 -21 "/>				
</frame>
<quad pos="-0.2 -5.5" z-index="0" size="74.6 32" bgcolor="24262f" opacity="0.9"/>
</frame>




<!-- WIDGET BOTTOM -->

<frame pos="0 -68.5">
<label pos="0 -6" z-index="0" size="90 12" text="player username" halign="center" valign="center2" textprefix="$i$t" textfont="GameFontSemiBold"/>
<quad pos="0 0" z-index="0" size="128 12" style="UICommon64_1" substyle="BgFrame2" colorize="24262f"  halign="center"/>
<frame pos="-64 0">
<label pos="10 -6" z-index="4" size="20 12" text="3rd" valign="center2" halign="center" textfont="GameFontSemiBold" textprefix="$i" textsize="4"/>
<quad pos="0 -6" z-index="1" size="20 11.9" style="UICommon64_1" substyle="BgFrame2" colorize="4357ea"  valign="center"/>
<quad z-index="2" size="20 11.8" image="file://Media/Painter/Stencils/15-Stripes/_Stripe0Grad/Brush.tga" opacity="1" modulatecolor="24262f" pos="10 -6" halign="center" rot="180" valign="center"/>
</frame>
<frame pos="44 0">
<label pos="10 -6" z-index="4" size="20 12" text="+5.124" valign="center2" halign="center" textfont="GameFontSemiBold" textprefix="$i" textsize="3"/>
<quad pos="0 -6" z-index="1" size="20 11.9" style="UICommon64_1" substyle="BgFrame2" colorize="4357ea"  valign="center"/>
<quad z-index="2" size="20 11.8" image="file://Media/Painter/Stencils/15-Stripes/_Stripe0Grad/Brush.tga" opacity="1" modulatecolor="24262f" pos="10 -6" halign="center" valign="center"/>
</frame>
</frame>

<script><!-- 
#Include "MathLib" as ML
#Include "TextLib" as TL

#Struct K_Player {
	Integer Rank;
	Integer PrevRank;
	Text	Login;
	Text	Name;
	Integer Time;
}
#Const json """{
"pl1": {"Rank": 1, "Name": "Player 1", "Time": 102448},
"pl2": {"Rank": 2, "Name": "Player 2", "Time": 132442},
"pl3": {"Rank": 3, "Name": "Player 3", "Time": 162446},
"pl4": {"Rank": 4, "Name": "Player 4", "Time": 172443},
"pl5": {"Rank": 5, "Name": "Player 5", "Time": 222445}
}"""

#Const json2 """{
"pl1": {"Rank": 4, "Name": "Player 1", "Time": 152448},
"pl2": {"Rank": 3, "Name": "Player 2", "Time": 192442},
"pl3": {"Rank": 5, "Name": "Player 3", "Time": 222446},
"pl4": {"Rank": 1, "Name": "Player 4", "Time": 224443},
"pl5": {"Rank": 2, "Name": "Player 5", "Time": 226445}
}"""

declare K_Player[Text] RankPlayers;

Vec3[] GetColors(Integer Pos) {
	switch (Pos) {
		case 1: return [TL::ToColor("dc0"), TL::ToColor("000")];
		case 2: return [TL::ToColor("bbb"), TL::ToColor("000")];
		case 3: return [TL::ToColor("963"), TL::ToColor("000")]; 	
	}
	 return [TL::ToColor("555") , TL::ToColor("fff")];
}

Void UpdateRanking() {
	foreach (Key => Player in RankPlayers) {
				let PlFrame = Page.GetFirstChild("players") as CMlFrame;
				if (!PlFrame.Controls.existskey(Player.PrevRank-1)) continue;
				declare CMlFrame Frame <=> PlFrame.Controls[Player.PrevRank-1] as CMlFrame;
				Frame.RelativePosition_V3 = <0., -(7. * (Player.PrevRank-1))>;
				(Frame.Controls[0] as CMlQuad).Colorize = GetColors(Player.Rank)[0];
				(Frame.Controls[1] as CMlLabel).TextColor = GetColors(Player.Rank)[1];
				(Frame.Controls[1] as CMlLabel).Value = ""^Player.Rank;
				(Frame.Controls[2] as CMlLabel).Value = Player.Name;
				(Frame.Controls[3] as CMlLabel).Value = TL::TimeToText(Player.Time, True, True);
				let NewPos = - (7. * (Player.Rank-1));
				AnimMgr.Flush(Frame);			
				AnimMgr.Add(Frame, "<frame pos=\"0 "^NewPos^"\" />", 400, CAnimManager::EAnimManagerEasing::QuadOut);
		}
}



main() {
	RankPlayers.fromjson(json);
	let PlFrame = Page.GetFirstChild("players") as CMlFrame;	
	foreach (Key => Player in RankPlayers) {
			if (!PlFrame.Controls.existskey(Player.Rank-1)) continue;
			declare CMlFrame Frame <=> PlFrame.Controls[Player.Rank-1] as CMlFrame;
			Frame.RelativePosition_V3 = <0., -(7. * (Player.Rank-1))>;
			(Frame.Controls[0] as CMlQuad).Colorize = GetColors(Player.Rank)[0];
			(Frame.Controls[1] as CMlLabel).TextColor = GetColors(Player.Rank)[1];
			(Frame.Controls[1] as CMlLabel).Value = ""^Player.Rank;
			(Frame.Controls[2] as CMlLabel).Value = Player.Name;
			(Frame.Controls[3] as CMlLabel).Value = TL::TimeToText(Player.Time, True, True);
	}
	while(True) {
	yield;
	
	foreach (Event in PendingEvents) {
			if(Event.Type == CMlScriptEvent::Type::MouseClick && Event.ControlId == "Update") {

				declare K_Player[Text] NewRankPlayer;
				NewRankPlayer.fromjson(json2);
				foreach(Login => NewPlayer in NewRankPlayer) {
						declare K_Player CurrPlayer = RankPlayers[Login];
						CurrPlayer.PrevRank = CurrPlayer.Rank;
						CurrPlayer.Rank = NewPlayer.Rank;
						CurrPlayer.Time = NewPlayer.Time;
						CurrPlayer.Name = NewPlayer.Name;
						RankPlayers[Login] = CurrPlayer;
				}
				UpdateRanking();				
			}	
	}
}
}



--></script>

</manialink>